<div class="container mx-auto">
  <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">Check Your Fit</h1>
  <p class="text-gray-600 dark:text-gray-400 mb-6">Use your camera for an instant AI-powered size prediction.</p>

  <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 min-h-[500px] flex flex-col items-center justify-center">

    @if (scanState() === 'idle') {
      <div class="text-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-16 w-16 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
        <h3 class="mt-2 text-xl font-medium text-gray-900 dark:text-white">Ready to find your fit?</h3>
        <p class="mt-1 text-gray-500 dark:text-gray-400">Position yourself in a well-lit area for the best results.</p>
        <button (click)="startScan()" class="mt-6 inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary transition-transform transform hover:scale-105">
          Scan Now
        </button>
      </div>
    }

    @if (scanState() === 'requesting') {
      <div class="text-center">
        <p>Requesting camera access...</p>
      </div>
    }

    @if (scanState() === 'streaming' || scanState() === 'scanning') {
      <div class="w-full max-w-lg mx-auto text-center">
        <video #videoElement autoplay playsinline class="w-full rounded-lg shadow-md aspect-video object-cover" [class.blur-sm]="scanState() === 'scanning'"></video>
        @if (scanState() === 'streaming') {
          <p class="mt-4 text-gray-600 dark:text-gray-300">Pose front-facing, then click 'Start Scan'.</p>
          <button (click)="simulateScan()" class="mt-4 inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
            Start Scan
          </button>
        }
        @if (scanState() === 'scanning') {
          <div class="mt-4">
            <p class="text-lg font-semibold text-primary">Scanning...</p>
            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5 mt-2">
              <div class="bg-primary h-2.5 rounded-full" [style.width.%]="scanProgress()"></div>
            </div>
          </div>
        }
      </div>
    }

    @if (scanState() === 'results') {
      <div class="text-center w-full max-w-md">
        <h3 class="text-2xl font-bold text-gray-900 dark:text-white">Your AI-Predicted Fit!</h3>
        <div class="mt-4 bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
          <table class="w-full text-left">
            <tbody>
              <tr class="border-b dark:border-gray-600"><td class="py-2 font-medium">Bust</td><td class="text-right">{{ predictions()?.bust }}</td></tr>
              <tr class="border-b dark:border-gray-600"><td class="py-2 font-medium">Waist</td><td class="text-right">{{ predictions()?.waist }}</td></tr>
              <tr class="border-b dark:border-gray-600"><td class="py-2 font-medium">Hips</td><td class="text-right">{{ predictions()?.hips }}</td></tr>
              <tr class="border-b dark:border-gray-600"><td class="py-2 font-bold text-primary">Top Size</td><td class="text-right font-bold text-primary">{{ predictions()?.topSize }}</td></tr>
              <tr><td class="py-2 font-bold text-primary">Bottom Size</td><td class="text-right font-bold text-primary">{{ predictions()?.bottomSize }}</td></tr>
            </tbody>
          </table>
        </div>
        <div class="mt-6 flex items-center justify-center gap-4">
          <button (click)="reset()" class="px-6 py-2 border border-gray-300 dark:border-gray-600 text-base font-medium rounded-md text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700">Scan Again</button>
          <button (click)="saveResults()" class="px-6 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary-600">Save to History</button>
        </div>
      </div>
    }

    @if (scanState() === 'error') {
      <div class="text-center text-red-500">
        <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
        <h3 class="mt-2 text-xl font-medium">Camera Error</h3>
        <p class="mt-1">{{ errorMessage() }}</p>
        <div class="mt-6 flex items-center justify-center gap-4">
          <button (click)="reset()" class="px-4 py-2 border rounded-md">Try Again</button>
          <button (click)="switchToManual()" class="px-4 py-2 border rounded-md">Enter Manually</button>
        </div>
      </div>
    }
    
    @if (scanState() === 'manual') {
      <div class="text-center w-full max-w-md">
        <h3 class="text-xl font-medium">Manual Input</h3>
        <p class="mt-1 text-gray-500 dark:text-gray-400">Please enter your measurements.</p>
        <p class="mt-4 text-gray-600 dark:text-gray-300">Manual input form is a placeholder for this demo.</p>
        <button (click)="reset()" class="mt-6 px-4 py-2 border rounded-md">Back to Scan</button>
      </div>
    }
    
  </div>
</div>
